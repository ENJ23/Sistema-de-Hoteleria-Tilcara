<div class="form-container">
  <div class="form-header">
    <div class="header-content">
      <div class="title-section">
        <mat-icon class="header-icon">{{ isEditMode ? 'edit' : 'add_home' }}</mat-icon>
        <div class="title-text">
          <h1 class="form-title">{{ isEditMode ? 'Editar Habitaci贸n' : 'Nueva Habitaci贸n' }}</h1>
          <p class="form-subtitle">Complete el formulario para {{ isEditMode ? 'actualizar' : 'crear' }} la habitaci贸n</p>
        </div>
      </div>
      <div class="progress-indicator" *ngIf="submitting">
        <mat-progress-bar mode="indeterminate" color="primary"></mat-progress-bar>
      </div>
    </div>
  </div>

  <mat-card class="form-card">
    <mat-card-content class="form-content">
      <form [formGroup]="habitacionForm" (ngSubmit)="onSubmit()" class="habitacion-form">
        <!-- Informaci贸n B谩sica -->
        <div class="form-section">
          <div class="section-header">
            <mat-icon class="section-icon">info</mat-icon>
            <h3 class="section-title">Informaci贸n B谩sica</h3>
          </div>
          
          <div class="form-grid">
            <!-- N煤mero de Habitaci贸n -->
            <div class="form-field-container">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>N煤mero de Habitaci贸n</mat-label>
                <input matInput type="text" formControlName="numero" placeholder="Ej: 101, 202A">
                <mat-icon matSuffix>room</mat-icon>
                <mat-hint>Ejemplos: 101, 202A, 305B</mat-hint>
                <mat-error *ngIf="habitacionForm.get('numero')?.hasError('required')">
                   El n煤mero de habitaci贸n es obligatorio
                </mat-error>
                <mat-error *ngIf="habitacionForm.get('numero')?.hasError('pattern')">
                   Formato inv谩lido. Use n煤meros y una letra opcional (ej: 101, 202A)
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Tipo de Habitaci贸n -->
            <div class="form-field-container">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Tipo de Habitaci贸n</mat-label>
                <mat-select formControlName="tipo" required>
                  <mat-option *ngFor="let tipo of tiposHabitacion" [value]="tipo">
                    {{ tipo }}
                  </mat-option>
                </mat-select>
                <mat-icon matSuffix>category</mat-icon>
                <mat-error *ngIf="habitacionForm.get('tipo')?.hasError('required')">
                   El tipo de habitaci贸n es obligatorio
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Piso -->
            <div class="form-field-container">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Piso</mat-label>
                <input matInput type="number" formControlName="piso" min="1" max="50">
                <mat-icon matSuffix>layers</mat-icon>
                <mat-error *ngIf="habitacionForm.get('piso')?.hasError('required')">
                   El piso es obligatorio
                </mat-error>
                <mat-error *ngIf="habitacionForm.get('piso')?.hasError('min') || habitacionForm.get('piso')?.hasError('max')">
                   El piso debe estar entre 1 y 50
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Capacidad -->
            <div class="form-field-container">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Capacidad (personas)</mat-label>
                <input matInput type="number" formControlName="capacidad" min="1" max="10">
                <mat-icon matSuffix>people</mat-icon>
                <mat-error *ngIf="habitacionForm.get('capacidad')?.hasError('required')">
                   La capacidad es obligatoria
                </mat-error>
                <mat-error *ngIf="habitacionForm.get('capacidad')?.hasError('min') || habitacionForm.get('capacidad')?.hasError('max')">
                   La capacidad debe estar entre 1 y 10 personas
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>

        <!-- Precios y Disponibilidad -->
        <div class="form-section">
          <div class="section-header">
            <mat-icon class="section-icon">attach_money</mat-icon>
            <h3 class="section-title">Precios y Disponibilidad</h3>
          </div>
          
          <div class="form-grid">
            <!-- Precio Base -->
            <div class="form-field-container">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Precio Base por Noche</mat-label>
                <span matPrefix class="currency-prefix">$</span>
                <input matInput type="number" step="0.01" formControlName="precioBase" min="0" max="500000">
                <mat-icon matSuffix>monetization_on</mat-icon>
                <mat-hint>Precio est谩ndar de la habitaci贸n</mat-hint>
                <mat-error *ngIf="habitacionForm.get('precioBase')?.hasError('required')">
                   El precio base es obligatorio
                </mat-error>
                <mat-error *ngIf="habitacionForm.get('precioBase')?.hasError('min')">
                   El precio debe ser mayor a $0
                </mat-error>
                <mat-error *ngIf="habitacionForm.get('precioBase')?.hasError('max')">
                   El precio no puede superar los $500,000
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Precio Actual -->
            <div class="form-field-container">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Precio Actual por Noche</mat-label>
                <span matPrefix class="currency-prefix">$</span>
                <input matInput type="number" step="0.01" formControlName="precioActual" min="0" max="500000">
                <mat-icon matSuffix>local_offer</mat-icon>
                <mat-hint>Puede ser diferente del precio base por promociones</mat-hint>
                <mat-error *ngIf="habitacionForm.get('precioActual')?.hasError('required')">
                  El precio actual es requerido
                </mat-error>
                <mat-error *ngIf="habitacionForm.get('precioActual')?.hasError('min')">
                  El precio debe ser mayor o igual a 0
                </mat-error>
                <mat-error *ngIf="habitacionForm.get('precioActual')?.hasError('max')">
                  El precio no puede superar los $500,000
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Activa -->
            <div class="form-field-container checkbox-container">
              <mat-checkbox formControlName="activa" class="status-checkbox">
                <span class="checkbox-content">
                  <mat-icon class="checkbox-icon">check_circle</mat-icon>
                  Habitaci贸n activa
                </span>
              </mat-checkbox>
              <p class="checkbox-hint">Las habitaciones inactivas no aparecer谩n en las b煤squedas de reservas</p>
            </div>
          </div>
        </div>

        <!-- Descripci贸n -->
        <div class="form-section">
          <div class="section-header">
            <mat-icon class="section-icon">description</mat-icon>
            <h3 class="section-title">Descripci贸n</h3>
          </div>
          
          <div class="form-field-container full-width">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Descripci贸n de la habitaci贸n</mat-label>
              <textarea 
                matInput 
                formControlName="descripcion" 
                rows="4"
                [maxlength]="MAX_LONGITUD_DESCRIPCION"
                placeholder="Describa las caracter铆sticas especiales, vistas, comodidades y detalles 煤nicos de la habitaci贸n...">
              </textarea>
              <mat-icon matSuffix>edit_note</mat-icon>
              <mat-hint align="end" class="character-count">
                {{ habitacionForm.get('descripcion')?.value?.length || 0 }}/{{ MAX_LONGITUD_DESCRIPCION }} caracteres
              </mat-hint>
              <mat-error *ngIf="habitacionForm.get('descripcion')?.hasError('maxlength')">
                La descripci贸n no puede superar los {{ MAX_LONGITUD_DESCRIPCION }} caracteres
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Servicios -->
        <div class="form-section">
          <div class="section-header">
            <mat-icon class="section-icon">room_service</mat-icon>
            <h3 class="section-title">Servicios y Amenidades</h3>
            <div class="services-counter">
              <span class="counter-text">
                {{ (habitacionForm.get('servicios')?.value?.length || 0) }}/{{ MAX_SERVICIOS }} seleccionados
              </span>
            </div>
          </div>
          
          <div class="services-grid">
            <div class="service-item" *ngFor="let servicio of serviciosDisponibles">
              <mat-checkbox 
                [checked]="isServicioSeleccionado(servicio)"
                (change)="toggleServicio(servicio)"
                [disabled]="!isServicioSeleccionado(servicio) && (habitacionForm.get('servicios')?.value?.length || 0) >= MAX_SERVICIOS"
                class="service-checkbox">
                <span class="service-content">
                  <mat-icon class="service-icon">room_service</mat-icon>
                  <span class="service-name">{{ servicio }}</span>
                </span>
              </mat-checkbox>
            </div>
          </div>
          
          <div class="services-limit-warning" *ngIf="(habitacionForm.get('servicios')?.value?.length || 0) >= MAX_SERVICIOS">
            <mat-icon class="warning-icon">info</mat-icon>
            <span>Has alcanzado el l铆mite de {{ MAX_SERVICIOS }} servicios seleccionados.</span>
          </div>
        </div>

        <!-- Botones de Acci贸n -->
        <div class="form-actions">
          <div class="actions-container">
            <button 
              type="button" 
              mat-stroked-button 
              color="warn" 
              (click)="onCancel()" 
              class="cancel-button"
              [disabled]="submitting">
              <mat-icon>close</mat-icon>
              <span>Cancelar</span>
            </button>
            
            <button 
              type="submit" 
              mat-raised-button 
              color="primary"
              class="submit-button"
              [disabled]="habitacionForm.invalid || submitting">
              <mat-icon *ngIf="!submitting">{{ isEditMode ? 'save' : 'add_circle' }}</mat-icon>
              <mat-spinner *ngIf="submitting" diameter="20"></mat-spinner>
              <span>{{ isEditMode ? 'Actualizar Habitaci贸n' : 'Crear Habitaci贸n' }}</span>
            </button>
          </div>
          
          <!-- Informaci贸n del formulario -->
          <div class="form-info" *ngIf="habitacionForm.dirty">
            <mat-icon class="info-icon">info</mat-icon>
            <span>Tienes cambios sin guardar</span>
          </div>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
