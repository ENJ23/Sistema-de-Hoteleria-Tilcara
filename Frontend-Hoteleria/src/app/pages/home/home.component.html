<div class="dashboard-hostal">
  <!-- Header del Dashboard -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <mat-icon>hotel</mat-icon>
        Dashboard del Hostal
      </h1>
    </div>
    <div class="header-actions">
      <button mat-raised-button color="accent" class="btn-gestionar-habitaciones" (click)="gestionarHabitaciones()">
        <mat-icon>bed</mat-icon>
        HABITACIONES
      </button>
      <button mat-raised-button class="btn-auditoria" (click)="irAAuditoriaReservas()"
        style="background: #673AB7; color: white;" matTooltip="Ver historial de cambios en reservas">
        <mat-icon>history</mat-icon>
        AUDITORÍA
      </button>
      <button mat-icon-button color="primary" class="btn-refresh" (click)="refrescarDatos()"
        matTooltip="Refrescar datos">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </div>

  <!-- Estadísticas Rápidas -->
  <div class="stats-grid">
    <mat-card class="stat-card ocupacion">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>hotel</mat-icon>
        </div>
        <div class="stat-info">
          <div class="stat-number">{{ estadisticas.ocupacionActual }}/{{ estadisticas.totalHabitaciones }}</div>
          <div class="stat-label">Habitaciones Ocupadas</div>
          <div class="stat-percentage">{{ estadisticas.porcentajeOcupacion }}%</div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card pendientes">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>pending</mat-icon>
        </div>
        <div class="stat-info">
          <div class="stat-number">{{ estadisticas.reservasPendientes }}</div>
          <div class="stat-label">Reservas Pendientes</div>
          <div class="stat-detail">{{ estadisticas.pagosPendientes }} pagos pendientes</div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Sección Principal -->
  <div class="main-content">
    <!-- Layout para computadora: To-Do List compacta arriba, Calendario abajo -->
    <div class="desktop-layout">
      <!-- To-Do List Compacta -->
      <mat-card class="content-card todo-card-compact">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>checklist</mat-icon>
            Tareas del Día
          </mat-card-title>
          <mat-card-subtitle>Gestión de tareas diarias</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <app-todo-list></app-todo-list>
        </mat-card-content>
      </mat-card>

      <!-- Calendario de Ocupación - Estilo Timeline -->
      <mat-card class="content-card calendario-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>calendar_today</mat-icon>
            Calendario de Ocupación
          </mat-card-title>
          <mat-card-subtitle>Vista timeline de disponibilidad por habitación</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <app-home-calendar [diasCalendario]="diasCalendario" [ocupacionHabitaciones]="ocupacionHabitaciones"
            [cargando]="cargandoOcupacion" [fechaReferencia]="fechaReferencia" [mesesMostrados]="mesesMostrados"
            (mesesMostradosChange)="onCambiarMesesMostrados($event)" (mesAnterior)="onMesAnterior()"
            (mesSiguiente)="onMesSiguiente()" (celdaClick)="onCeldaClick($event)"
            (moverReserva)="onMoverReserva($event)">
          </app-home-calendar>
        </mat-card-content>
      </mat-card>

      <!-- Tareas Completadas -->
      <mat-card class="content-card completed-tasks-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>task_alt</mat-icon>
            Tareas Completadas
          </mat-card-title>
          <mat-card-subtitle>Historial de tareas finalizadas</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="tareas-filtros">
            <mat-form-field appearance="outline" class="tareas-filtro">
              <mat-label>Tipo</mat-label>
              <mat-select [(ngModel)]="filtroTipoTarea" (selectionChange)="onFiltrosTareasChange()">
                <mat-option value="">Todos</mat-option>
                <mat-option *ngFor="let tipo of tiposTarea" [value]="tipo.valor">{{ tipo.label }}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="tareas-filtro">
              <mat-label>Habitacion</mat-label>
              <mat-select [(ngModel)]="filtroHabitacion" (selectionChange)="onFiltrosTareasChange()">
                <mat-option value="">Todas</mat-option>
                <mat-option *ngFor="let hab of habitacionesFiltro" [value]="hab._id">Habitacion {{ hab.numero }}</mat-option>
              </mat-select>
            </mat-form-field>

            <button mat-stroked-button color="primary" class="btn-limpiar-filtros" (click)="limpiarFiltrosTareas()">
              <mat-icon>clear</mat-icon>
              Limpiar filtros
            </button>
          </div>

          <div class="tareas-loading" *ngIf="cargandoTareasCompletadas">Cargando tareas completadas...</div>

          <div class="tareas-completadas-list" *ngIf="!cargandoTareasCompletadas && tareasCompletadasPaginadas.length > 0; else sinTareasCompletadas">
            <div class="tarea-completada-item" *ngFor="let tarea of tareasCompletadasPaginadas">
              <div class="tarea-icon">
                <mat-icon [style.color]="tareaService.obtenerColorTipo(tarea.tipo)">{{ tareaService.obtenerIconoTipo(tarea.tipo) }}</mat-icon>
              </div>
              <div class="tarea-info">
                <div class="tarea-titulo">{{ tarea.descripcion }}</div>
                <div class="tarea-meta">
                  Habitacion {{ tarea.habitacion?.numero || 'N/A' }} · {{ tarea.tipo | titlecase }}
                </div>
                <div *ngIf="tarea.configuracionCamas && tarea.configuracionCamas.length > 0" class="tarea-camas-container">
                  <mat-icon class="cama-icon">bed</mat-icon>
                  <span class="tarea-camas">
                    <span *ngFor="let cama of tarea.configuracionCamas; let last = last">
                      {{ cama.cantidad }} {{ cama.tipo | titlecase }}{{ !last ? ', ' : '' }}
                    </span>
                  </span>
                </div>
                <div *ngIf="tarea.observaciones" class="tarea-observaciones">
                  <mat-icon class="obs-icon">notes</mat-icon>
                  <span>{{ tarea.observaciones }}</span>
                </div>
              </div>
              <div class="tarea-fecha">
                <div class="tarea-fecha-label">Completada</div>
                <div class="tarea-fecha-valor">{{ tarea.fechaCompletada | date:'short' }}</div>
              </div>
            </div>
          </div>

          <ng-template #sinTareasCompletadas>
            <div class="tareas-vacias">
              <mat-icon>event_available</mat-icon>
              <p>No hay tareas completadas para mostrar.</p>
            </div>
          </ng-template>

          <mat-paginator
            *ngIf="!cargandoTareasCompletadas && totalTareasCompletadas > 0"
            [length]="totalTareasCompletadas"
            [pageSize]="pageSizeTareas"
            [pageIndex]="pageIndexTareas"
            [pageSizeOptions]="[10, 20, 50]"
            (page)="onPageChangeTareas($event)">
          </mat-paginator>
        </mat-card-content>
      </mat-card>
    </div> <!-- Cierre del desktop-layout -->

  </div>

  <!-- Lista de Reservas del Día -->
  <mat-card class="content-card reservas-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>today</mat-icon>
        Reservas del Día
      </mat-card-title>
      <mat-card-subtitle>{{ fechaActual | date:'fullDate' }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="reservas-lista" *ngIf="reservasHoy.length > 0; else sinReservas">
        <div class="reserva-item" *ngFor="let reserva of reservasHoy" (click)="verDetalleReserva(reserva)">
          <div class="reserva-hora">
            <div class="hora-entrada">{{ reserva.horaEntrada }}</div>
            <div class="hora-salida">{{ reserva.horaSalida }}</div>
          </div>

          <div class="reserva-info">
            <div class="cliente-nombre">{{ reserva.cliente?.nombre }} {{ reserva.cliente?.apellido }}</div>
            <div class="habitacion-info">Habitación {{ obtenerNumeroHabitacion(reserva.habitacion) }} ({{
              obtenerTipoHabitacion(reserva.habitacion) }})
            </div>
          </div>

          <div class="reserva-estado">
            <mat-chip [ngClass]="'estado-' + (reserva.estado || '').toLowerCase()" class="estado-chip">
              {{ reserva.estado }}
            </mat-chip>
          </div>

          <div class="reserva-pago">
            <mat-icon [ngClass]="(reserva.montoPagado || 0) >= (reserva.precioTotal || 0) ? 'pagado' : 'pendiente'">
              {{ (reserva.montoPagado || 0) >= (reserva.precioTotal || 0) ? 'check_circle' : 'pending' }}
            </mat-icon>
            <span>{{ (reserva.montoPagado || 0) >= (reserva.precioTotal || 0) ? 'PAGADO' : 'PENDIENTE' }}</span>
          </div>

          <div class="reserva-acciones">
            <button mat-icon-button color="primary" (click)="editarReserva(reserva)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="accent" (click)="imprimirReserva(reserva)">
              <mat-icon>print</mat-icon>
            </button>
          </div>
        </div>
      </div>

      <ng-template #sinReservas>
        <div class="sin-reservas">
          <mat-icon>event_busy</mat-icon>
          <p>No hay reservas para hoy</p>
          <button mat-raised-button color="primary" (click)="abrirNuevaReserva()">
            Crear Primera Reserva
          </button>
        </div>
      </ng-template>
    </mat-card-content>
  </mat-card>

</div>